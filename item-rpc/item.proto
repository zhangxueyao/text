syntax = "proto3";
package item;
option go_package = "./itemrpc";

message GetStockReq {
  int64 Sku = 1;
}
message GetStockResp   {
  int64 Sku = 1;
  int64 Qty = 2;
  int64 Version = 3;
}
message DeductStockReq {
  int64 Sku = 1;
  int64 delta = 2;
}

message DeductStockResp {
  bool success = 1;
  string message = 2;
}


message User {
  string mobile = 1;
  string password = 2;
  string email = 3;
  int32 age = 4;
  string gender = 5;
}

message RegisterReq {
  User user = 1;
}

message RegisterResp {
  bool success = 1;
  string message = 2;
}

message GetUserReq {
  string mobile = 1;
}

message GetUserResp {
  User user = 1;
  bool exists = 2;
}

message PayTryReq {
  string xid = 1;         // 全局事务ID
  int64  user_id = 2;
  int64  order_id = 3;
  int64  amount = 4;      // 分（正整数）
}

message PayAck {bool ok = 1;}

message PayConfirmReq {string xid = 1; int64 user_id = 2; int64 order_id = 3; int64 amount = 4;}
message PayCancelReq  {string xid = 1; int64 user_id = 2; int64 order_id = 3; int64 amount = 4;}


service Item {
  rpc GetStock (GetStockReq) returns (GetStockResp);
  rpc DeductStock (DeductStockReq) returns (DeductStockResp);
  rpc Register (RegisterReq) returns (RegisterResp);
  rpc GetUser (GetUserReq) returns (GetUserResp);
  rpc TryPay     (PayTryReq)     returns (PayAck);
  rpc ConfirmPay (PayConfirmReq) returns (PayAck);
  rpc CancelPay  (PayCancelReq)  returns (PayAck);
}